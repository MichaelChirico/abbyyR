<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Getting Text from Wisconsin Ads Storyboards Using abbyyR &bull; abbyyR</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">abbyyR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/pkgdown.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="http://github.com/soodoku/abbyyR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Getting Text from Wisconsin Ads Storyboards Using abbyyR</h1>
                        <h4 class="author">Gaurav Sood</h4>
            
            <h4 class="date">2016-12-06</h4>
          </div>

    
    
<div class="contents">
<div id="abbyyr-getting-text-from-wisconsin-ads-storyboards" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#abbyyr-getting-text-from-wisconsin-ads-storyboards" class="anchor"> </a></body></html>abbyyR: Getting Text from Wisconsin Ads Storyboards</h3>
<p><a href="http://wiscadproject.wisc.edu/download.php">Wisconsin Ads Project</a> (now at <a href="http://mediaproject.wesleyan.edu/">Wesleyan</a>) archives data on televised presidential, gubernatorial and congressional ads collected by <a href="http://www.kantarmedia.com/">Kantar media</a>. The data includes flattened storyboards of each political ad. These storyboards are pdfs of static images for the years 2000 and 2002 (gubernatorial ads). (Since 2004, the storyboards have included an extractable text layer. The script for extracting the text layer using PyPdf can be found <a href="https://gist.github.com/soodoku/62a3172eb1b4a55dee1a">here</a>.)</p>
<p>Here below are the steps for getting text from static image storyboads using abbyyR.</p>
<div id="load-the-package" class="section level4">
<h4 class="hasAnchor"><html><body><a href="#load-the-package" class="anchor"> </a></body></html>Load the package</h4>
<p>To get started, load the package. The latest version of the package will always be on github. Instructions for installing the package from github are provided below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(abbyyR)</code></pre></div>
</div>
<div id="set-credentials" class="section level4">
<h4 class="hasAnchor"><html><body><a href="#set-credentials" class="anchor"> </a></body></html>Set credentials</h4>
<p>Your first task on loading the package should be to set the credentials - application ID and password. If you haven&rsquo;t already, you can get this information <a href="http://ocrsdk.com/" class="uri">http://ocrsdk.com/</a>. Once you have the application ID and password, set it via the <code>setapp</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># setapp(c("factbook", "7YVBc8E6xMricoTwp0mF0aH"))</span></code></pre></div>
</div>
<div id="start-from-a-clean-slate" class="section level4">
<h4 class="hasAnchor"><html><body><a href="#start-from-a-clean-slate" class="anchor"> </a></body></html>Start from a Clean Slate</h4>
<p>Some of you may want to start by deleting all existing tasks in an application.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"</span>
<span class="st">all_tasks &lt;- listTasks()</span>
<span class="st">for (i in 1:nrow(all_tasks)) deleteTask(all_tasks$id[i]) </span>
<span class="st">"</span></code></pre></div>
</div>
<div id="submit-all-images-in-a-directory" class="section level4">
<h4 class="hasAnchor"><html><body><a href="#submit-all-images-in-a-directory" class="anchor"> </a></body></html>Submit All Images in a Directory</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Set path to directory with all the images</span>
path_to_img_dir &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">path.package</span>(<span class="st">"abbyyR"</span>),<span class="st">"/inst/extdata/wisc_ads/"</span>)
total_files &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">dir</span>(path_to_img_dir))

<span class="co"># Iterate through the files and submit all the images</span>

<span class="co"># Monitor progress via progress bar package</span>
<span class="kw">library</span>(progress)
pb &lt;-<span class="st"> </span>progress_bar$<span class="kw">new</span>(<span class="dt">format =</span> <span class="st">"  downloading [:bar] :percent</span><span class="ch">\n</span><span class="st">"</span>,
                        <span class="dt">total =</span> total_files, 
                        <span class="dt">clear =</span> <span class="ot">FALSE</span>, <span class="dt">width=</span> <span class="dv">60</span>)

<span class="co"># Abbyy Fine API doesn't keep the file name so we have to keep track of it locally</span>
tracker &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">filename=</span><span class="ot">NA</span>, <span class="dt">taskid=</span><span class="ot">NA</span>)

<span class="co"># Loop</span>
j &lt;-<span class="st"> </span><span class="dv">1</span>

for (i in <span class="kw">dir</span>(path_to_img_dir)){
    
    <span class="co"># Assuming only 1 dot in the file name</span>
    tracker[j,] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">basename</span>(i), <span class="st">"[.]"</span>))[<span class="dv">1</span>], <span class="kw"><a href="../reference/submitImage.html">submitImage</a></span>(<span class="dt">file_path=</span><span class="kw">paste0</span>(path_to_img_dir, i))$id)
    j &lt;-<span class="st"> </span>j +<span class="st"> </span><span class="dv">1</span>

    <span class="co"># Prg. bar</span>
    pb$<span class="kw">tick</span>()
    <span class="kw">Sys.sleep</span>(<span class="dv">1</span>/<span class="dv">100</span>)
}</code></pre></div>
</div>
<div id="process-all-the-files" class="section level4">
<h4 class="hasAnchor"><html><body><a href="#process-all-the-files" class="anchor"> </a></body></html>Process All the Files</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">for (i in <span class="dv">1</span>:<span class="kw">nrow</span>(tracker)) <span class="kw"><a href="../reference/processDocument.html">processDocument</a></span>(tracker$taskid[i]) </code></pre></div>
</div>
<div id="are-all-the-tasks-completed" class="section level4">
<h4 class="hasAnchor"><html><body><a href="#are-all-the-tasks-completed" class="anchor"> </a></body></html>Are all the tasks completed?</h4>
<p>You can either wait and check manually or ping after every few seconds to check status like so:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"</span>
<span class="st">i &lt;- 1</span>

<span class="st">while(i &lt; total_files){</span>
<span class="st">    i &lt;- nrow(listFinishedTasks())</span>
<span class="st">    if (i == total_files){</span>
<span class="st">        print("</span>All Done!<span class="st">")</span>
<span class="st">        break;</span>
<span class="st">    }</span>

<span class="st">    Sys.sleep(5)</span>
<span class="st">    }</span>
<span class="st">"</span></code></pre></div>
</div>
<div id="downloading-finished-files" class="section level4">
<h4 class="hasAnchor"><html><body><a href="#downloading-finished-files" class="anchor"> </a></body></html>Downloading Finished Files</h4>
<p>You need to setup an output folder. And then download all the completed files.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setwd</span>(<span class="kw">paste0</span>(<span class="kw">path.package</span>(<span class="st">"abbyyR"</span>),<span class="st">"/inst/extdata/wisc_out/"</span>))

finishedlist &lt;-<span class="st"> </span><span class="kw"><a href="../reference/listFinishedTasks.html">listFinishedTasks</a></span>()
results      &lt;-<span class="st"> </span><span class="kw">merge</span>(tracker, finishedlist, <span class="dt">by.x=</span><span class="st">"taskid"</span>, <span class="dt">by.y=</span><span class="st">"id"</span>)

<span class="kw">library</span>(curl)

for(i in <span class="dv">1</span>:<span class="kw">nrow</span>(results)){
    <span class="kw">curl_download</span>(results$resultUrl[i], <span class="dt">destfile=</span>results$filename[i])
}</code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Gaurav Sood.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer></div>

  </body></html>
